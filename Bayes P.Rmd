---
title: "Bayes"
author: "GPF"
date: "2022-12-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages, include=FALSE}
libraries("ggplot2", "cmdstanr", "HDInterval", "bayesplot", "easypackages")

# readxl: for reading data set
if (!require(readxl)) install.packages("readxl")
library(readxl)

if (!requireNamespace("BiocManager", quietly = TRUE)) install.packages("BiocManager")
BiocManager::install("genefilter", version = "3.15")
if (!requireNamespace("modeest")) install.packages("modeest")
library(modeest)
```

## Data
```{r}
write.csv(Data, 'data_full.csv')

Data$a_n <- paste(Data$areaIncorrect, Data$numIncorrect, sep = '_')

x= 1:81
Data$a_n2 = factor(Data$a_n, labels = c(unique(x)))
Data$a_n2 = as.numeric(Data$a_n2)

Data_43R = subset(Data, Data$bird == "43R")
Data_48W = subset(Data, Data$bird == "48W")
Data_54Y = subset(Data, Data$bird == "54Y")
Data_56Y = subset(Data, Data$bird == "56Y")

prueba <- Data_43R %>% select(accuracy, Euclidean, CityBlock, a_n2)
colnames(prueba) <- c('y', 'e', 'c', 'item')

prueba%>%
  pivot_wider(names_from = item, values_from =y)
wide







```



```{r}
Data = read.csv("DataBayes.csv")
Data = as.data.frame(Data)
Data$CityBlock = Data$CityBlock-16
```


```{r}
## City-Block Model
CityBlock_Model_Syntax = "

data {
  int<lower=0> N;
  vector[N] c;
  int<lower=0, upper=1> y[N];
}

parameters {
  real beta0;
  real betac;
}

## number of successes out of 2 trials (per day)
model {
  acc ~ binomial(2,inv_logit(alpha + betaC * cityblock + betaD * session));
}

generated quantities (R2)

Model comparison
For each value of acc in the iteration, get the LL
"
```

```{r}
CityBlock_Model_Stan = cmdstan_model(stan_file = write_stan_file(CityBlock_Model_Syntax))

mode04_StanData = list(
  N = nrow(Data),
  acc = Data$accuracy,
  cityblock = Data$CityBlock
)

CityBlock_Model_Samples = CityBlock_Model_Stan$sample(
  data = mode04_StanData,
  seed = 190920221,
  chains = 4,
  parallel_chains = 4,
  iter_warmup = 4000,
  iter_sampling = 4000
)

# assess convergence: summary of all parameters
CityBlock_Model_Samples$summary()

# maximum R-hat
max(CityBlock_Model_Samples$summary()$rhat, na.rm = TRUE)
```


```{r}
## Euclidean Model
Euclidean_Model_Syntax = "
data {
  int<lower=0> N;
  vector[N] Euclidean;
  int<lower=0, upper=1> acc[N];
}

parameters {
  real alpha;
  real beta;
}

model {
  acc ~ bernoulli_logit(alpha + beta * Euclidean);
}

"

Euclidean_Model_Stan = cmdstan_model(stan_file = write_stan_file(Euclidean_Model_Syntax))

mode04_StanData = list(
  N = nrow(Data),
  acc = Data$accuracy,
  Euclidean = Data$Euclidean
)

Euclidean_Model_Samples = Euclidean_Model_Stan$sample(
  data = mode04_StanData,
  seed = 190920221,
  chains = 4,
  parallel_chains = 4,
  iter_warmup = 4000,
  iter_sampling = 4000
)

# assess convergence: summary of all parameters
Euclidean_Model_Samples$summary()

# maximum R-hat
max(Euclidean_Model_Samples$summary()$rhat, na.rm = TRUE)
```
