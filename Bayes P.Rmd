---
title: "Bayes"
author: "GPF"
date: "2022-12-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages, include=FALSE}
#if (!require("easypackages")) install.packages("easypackages")
library(easypackages)
libraries("ggplot2", "cmdstanr", "HDInterval", "bayesplot")

# readxl: for reading data set
if (!require(readxl)) install.packages("readxl")
library(readxl)

if (!requireNamespace("BiocManager", quietly = TRUE)) install.packages("BiocManager")
BiocManager::install("genefilter", version = "3.15")
if (!requireNamespace("modeest")) install.packages("modeest")
library(modeest)
```

## Data
```{r}
Data = read.csv("DataBayes.csv")
```

```{r}
# IRT Model Syntax (slope/intercept form ) ==================================================
modelIRT_2PL_SI_syntax = "

data {
  int<lower=0> nObs;                            // number of observations

  vector[nItems] meanMu;             // prior mean vector for intercept parameters
  matrix[nItems, nItems] covMu;      // prior covariance matrix for intercept parameters
  
  vector[nItems] meanLambda;         // prior mean vector for discrimination parameters
  matrix[nItems, nItems] covLambda;  // prior covariance matrix for discrimination parameters
}

parameters {
  vector[nObs] theta;                // the latent variables (one for each person)
  vector[nItems] mu;                 // the item intercepts (one for each item)
  vector[nItems] lambda;             // the factor loadings/item discriminations (one for each item)
}

model {
  
  lambda ~ multi_normal(meanLambda, covLambda); // Prior for item discrimination/factor loadings
  mu ~ multi_normal(meanMu, covMu);             // Prior for item intercepts
  
  theta ~ normal(0, 1);                         // Prior for latent variable (with mean/sd specified)
  
  for (item in 1:nItems){
    Y[item] ~ bernoulli_logit(mu[item] + lambda[item]*theta);
  }
  
}

"
```


```{r}
model04_Syntax = "

data {
  int<lower=0> N;
  vector[N] cityblock;
}

parameters {
  real beta0;
  real betacity;
}

model {
  beta0 ~ normal(0,1000);
  betacity ~ normal(0,1000);
  
  acc ~ bernoulli_logit(beta0 + betacity);
}

"
```

```{r}
model04_Stan = cmdstan_model(stan_file = write_stan_file(model04_Syntax))

mode04_StanData = list(
  N = nrow(Data),
  acc = Data$accuracy,
  betacity = Data$xxxxx,
)

model04_Samples = model04_Stan$sample(
  data = mode04_StanData,
  seed = 190920221,
  chains = 4,
  parallel_chains = 4,
  iter_warmup = 4000,
  iter_sampling = 4000
)

# assess convergence: summary of all parameters
model04_Samples$summary()
```





```{r}
model04b_Syntax = "

data {
  int<lower=0> N;
  vector[N] Cityblock;
  vector[N] Euclidean;
}

parameters {
  real beta0;
  real betacity;
  real betaeuclidean;
}

model {
  beta0 ~ normal(0,1000);
  betacity ~ normal(0,1000);
  betaeuclidean ~ normal(0,1000);
  
  sigma ~ exponential(.1); // prior for sigma
  weightLB ~ bernoulli_logit(
    beta0 + betacity * betaeuclidean);
}

"
```







